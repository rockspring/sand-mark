pending = {java.util.ArrayList@1458}  size = 120
 0 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1659} "BLOCK: prefix=ab [61 62]"
 1 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1665} "BLOCK: prefix=ac [61 63]"
 2 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1666} "BLOCK: prefix=ad [61 64]"
 3 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1667} "TERM: aegis [61 65 67 69 73]"
 4 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1668} "TERM: aeon [61 65 6f 6e]"
 5 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1669} "TERM: aeronautics [61 65 72 6f 6e 61 75 74 69 63 73]"
 6 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1670} "TERM: aesthete [61 65 73 74 68 65 74 65]"
 7 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1671} "TERM: aesthetics [61 65 73 74 68 65 74 69 63 73]"
 8 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1672} "TERM: affable [61 66 66 61 62 6c 65]"
 9 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1673} "TERM: affectation [61 66 66 65 63 74 61 74 69 6f 6e]"
 10 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1674} "TERM: affected [61 66 66 65 63 74 65 64]"
 11 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1675} "TERM: affection [61 66 66 65 63 74 69 6f 6e]"
 12 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1676} "TERM: affectionate [61 66 66 65 63 74 69 6f 6e 61 74 65]"
 13 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1677} "TERM: affidavit [61 66 66 69 64 61 76 69 74]"
 14 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1678} "TERM: affiliate [61 66 66 69 6c 69 61 74 65]"
 15 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1679} "TERM: affiliation [61 66 66 69 6c 69 61 74 69 6f 6e]"
 16 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1680} "TERM: affinity [61 66 66 69 6e 69 74 79]"
 17 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1681} "TERM: affirmative [61 66 66 69 72 6d 61 74 69 76 65]"
 18 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1682} "TERM: affliction [61 66 66 6c 69 63 74 69 6f 6e]"
 19 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1683} "TERM: affront [61 66 66 72 6f 6e 74]"
 20 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1684} "TERM: aficionado [61 66 69 63 69 6f 6e 61 64 6f]"
 21 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1685} "TERM: aftermath [61 66 74 65 72 6d 61 74 68]"
 22 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1686} "TERM: agate [61 67 61 74 65]"
 23 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1687} "TERM: agenda [61 67 65 6e 64 61]"
 24 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1688} "TERM: agglomerate [61 67 67 6c 6f 6d 65 72 61 74 65]"
 25 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1689} "TERM: aggrandize [61 67 67 72 61 6e 64 69 7a 65]"
 26 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1690} "TERM: aggravate [61 67 67 72 61 76 61 74 65]"
 27 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1691} "TERM: aggregate [61 67 67 72 65 67 61 74 65]"
 28 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1692} "TERM: aggregation [61 67 67 72 65 67 61 74 69 6f 6e]"
 29 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1693} "TERM: aggressive [61 67 67 72 65 73 73 69 76 65]"
 30 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1694} "TERM: aggrieved [61 67 67 72 69 65 76 65 64]"
 31 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1695} "TERM: aghast [61 67 68 61 73 74]"
 32 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1696} "TERM: agitated [61 67 69 74 61 74 65 64]"
 33 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1697} "TERM: agitation [61 67 69 74 61 74 69 6f 6e]"
 34 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1698} "TERM: agnostic [61 67 6e 6f 73 74 69 63]"
 35 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1699} "TERM: agog [61 67 6f 67]"
 36 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1700} "TERM: agony [61 67 6f 6e 79]"
 37 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1701} "TERM: agreement [61 67 72 65 65 6d 65 6e 74]"
 38 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1702} "TERM: agronomist [61 67 72 6f 6e 6f 6d 69 73 74]"
 39 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1651} "TERM: ailment [61 69 6c 6d 65 6e 74]"
 40 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1703} "TERM: airborne [61 69 72 62 6f 72 6e 65]"
 41 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1704} "TERM: airtight [61 69 72 74 69 67 68 74]"
 42 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1705} "BLOCK: prefix=al [61 6c]"
 43 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1706} "BLOCK: prefix=am [61 6d]"
 44 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1707} "BLOCK: prefix=an [61 6e]"
 45 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1708} "TERM: aorta [61 6f 72 74 61]"
 46 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1709} "TERM: apathetic [61 70 61 74 68 65 74 69 63]"
 47 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1710} "TERM: apathy [61 70 61 74 68 79]"
 48 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1711} "TERM: aperitif [61 70 65 72 69 74 69 66]"
 49 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1712} "TERM: aperture [61 70 65 72 74 75 72 65]"
 50 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1713} "TERM: apex [61 70 65 78]"
 51 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1714} "TERM: aphasia [61 70 68 61 73 69 61]"
 52 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1715} "TERM: aphorism [61 70 68 6f 72 69 73 6d]"
 53 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1716} "TERM: apiary [61 70 69 61 72 79]"
 54 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1717} "TERM: apiculture [61 70 69 63 75 6c 74 75 72 65]"
 55 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1718} "TERM: aplomb [61 70 6c 6f 6d 62]"
 56 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1719} "TERM: apocalyptic [61 70 6f 63 61 6c 79 70 74 69 63]"
 57 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1720} "TERM: apocrypha [61 70 6f 63 72 79 70 68 61]"
 58 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1721} "TERM: apocryphal [61 70 6f 63 72 79 70 68 61 6c]"
 59 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1722} "TERM: apogee [61 70 6f 67 65 65]"
 60 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1723} "TERM: apologetic [61 70 6f 6c 6f 67 65 74 69 63]"
 61 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1724} "TERM: apology [61 70 6f 6c 6f 67 79]"
 62 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1725} "TERM: apoplectic [61 70 6f 70 6c 65 63 74 69 63]"
 63 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1726} "TERM: apostasy [61 70 6f 73 74 61 73 79]"
 64 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1727} "TERM: apostate [61 70 6f 73 74 61 74 65]"
 65 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1728} "TERM: apostrophe [61 70 6f 73 74 72 6f 70 68 65]"
 66 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1729} "TERM: apotheosis [61 70 6f 74 68 65 6f 73 69 73]"
 67 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1730} "BLOCK: prefix=app [61 70 70]"
 68 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1731} "TERM: apron [61 70 72 6f 6e]"
 69 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1732} "TERM: aquatic [61 71 75 61 74 69 63]"
 70 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1733} "TERM: aqueduct [61 71 75 65 64 75 63 74]"
 71 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1734} "TERM: aquiline [61 71 75 69 6c 69 6e 65]"
 72 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1735} "BLOCK: prefix=ar [61 72]"
 73 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1736} "BLOCK: prefix=as [61 73]"
 74 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1737} "TERM: atheism [61 74 68 65 69 73 6d]"
 75 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1738} "TERM: athletics [61 74 68 6c 65 74 69 63 73]"
 76 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1739} "TERM: atlas [61 74 6c 61 73]"
 77 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1740} "TERM: atonal [61 74 6f 6e 61 6c]"
 78 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1741} "TERM: atone [61 74 6f 6e 65]"
 79 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1742} "TERM: atonement [61 74 6f 6e 65 6d 65 6e 74]"
 80 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1743} "TERM: atrocious [61 74 72 6f 63 69 6f 75 73]"
 81 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1744} "TERM: atrocity [61 74 72 6f 63 69 74 79]"
 82 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1745} "TERM: atrophy [61 74 72 6f 70 68 79]"
 83 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1746} "TERM: attainment [61 74 74 61 69 6e 6d 65 6e 74]"
 84 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1747} "TERM: attentive [61 74 74 65 6e 74 69 76 65]"
 85 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1748} "TERM: attenuate [61 74 74 65 6e 75 61 74 65]"
 86 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1749} "TERM: attest [61 74 74 65 73 74]"
 87 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1750} "TERM: attic [61 74 74 69 63]"
 88 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1751} "TERM: attire [61 74 74 69 72 65]"
 89 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1752} "TERM: attorney [61 74 74 6f 72 6e 65 79]"
 90 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1753} "TERM: attribute [61 74 74 72 69 62 75 74 65]"
 91 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1754} "TERM: attribution [61 74 74 72 69 62 75 74 69 6f 6e]"
 92 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1755} "TERM: attrition [61 74 74 72 69 74 69 6f 6e]"
 93 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1756} "TERM: attune [61 74 74 75 6e 65]"
 94 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@1757} "BLOCK: prefix=au [61 75]"
 95 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1758} "TERM: avalanche [61 76 61 6c 61 6e 63 68 65]"
 96 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1759} "TERM: avant-garde [61 76 61 6e 74 2d 67 61 72 64 65]"
 97 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1760} "TERM: avarice [61 76 61 72 69 63 65]"
 98 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1761} "TERM: avaricious [61 76 61 72 69 63 69 6f 75 73]"
 99 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingTerm@1762} "TERM: avenge [61 76 65 6e 67 65]"


 private PendingBlock writeBlock(int prefixLength, boolean isFloor, int floorLeadLabel, int start, int end,
                                    boolean hasTerms, boolean hasSubBlocks) throws IOException
## 第一个子块写入

输入参数

```
prefixLength=1
isFloor=true
floorLeadLabel=-1
start=0
end=39
hasTerms=true
hasSubBlocks=true
```

函数执行状态

```
termsOut=FSIndexOutput(path="/Users/zlq/Projects/oss/lucene-solr/data/indexGREWords/_0_Lucene50_0.tim")
startFP=5266
hasFloorLeadLabel=false
prefix=a
numEntries=39
code=78

code以VInt编码写入到termsOut

isLeafBlock=false
subIndices为FST列表，指向子块的索引
```

处理索引块PendingBlock
```
block=BLOCK: prefix=ab [61 62]
suffix=1，block以当前writeBlock时的公共前缀为前缀时的后缀长度
suffix左移一位，并将最小位设置为1，以VInt编码写入到suffixWriter
block.prefix.bytes中的后缀字节以Bytes编码写入到suffixWriter
startFP - block.fp以VLong编码写入到suffixWriter，startFP为writeBlock方法写入数据的开始位置，block.fp为block的开始位置，block.fp=119
block.index加入到subIndices列表中
```

## 第二个子块写入

输入参数

```
prefixLength=1
isFloor=true
floorLeadLabel=105
start=39
end=69
hasTerms=true
hasSubBlocks=true
```

函数执行状态

```
termsOut=FSIndexOutput(path="/Users/zlq/Projects/oss/lucene-solr/data/indexGREWords/_0_Lucene50_0.tim")
startFP=5841
hasFloorLeadLabel=true
prefix=a
因为hasFloorLeadLabel为true，所以prefix在尾部多分配一个字节的空间
numEntries=30
code=60
code值的产生规则，numEntries左移一位，留出最小位用来标记当前子块是否为最后一个子块，如果是，最小位填充1，否则，最小位填充0

code以VInt编码写入到termsOut

isLeafBlock=false
subIndices为FST列表，指向子块的索引
```

## 第三个子块写入

输入参数

```
prefixLength=1
isFloor=true
floorLeadLabel=113
start=69
end=94
hasTerms=true
hasSubBlocks=true
```

函数执行状态

```
termsOut=FSIndexOutput(path="/Users/zlq/Projects/oss/lucene-solr/data/indexGREWords/_0_Lucene50_0.tim")
startFP=6253
hasFloorLeadLabel=true
prefix=a
因为hasFloorLeadLabel为true，所以prefix在尾部多分配一个字节的空间
numEntries=25
code=50
code值的产生规则，numEntries左移一位，留出最小位用来标记当前子块是否为最后一个子块，如果是，最小位填充1，否则，最小位填充0

code以VInt编码写入到termsOut

isLeafBlock=false
subIndices为FST列表，指向子块的索引
```

## 第四个（最后一个）子块写入

输入参数

```
prefixLength=1
isFloor=true
floorLeadLabel=117
start=94
end=120
hasTerms=true
hasSubBlocks=true
```

函数执行状态

```
termsOut=FSIndexOutput(path="/Users/zlq/Projects/oss/lucene-solr/data/indexGREWords/_0_Lucene50_0.tim")
startFP=6605
hasFloorLeadLabel=true
prefix=a
因为hasFloorLeadLabel为true，所以prefix在尾部多分配一个字节的空间
numEntries=26
code=53
code值的产生规则，numEntries左移一位，留出最小位用来标记当前子块是否为最后一个子块，如果是，最小位填充1，否则，最小位填充0

code以VInt编码写入到termsOut

isLeafBlock=false
subIndices为FST列表，指向子块的索引
```

四个子块写入完成后，得到newBlocks

```
newBlocks = {java.util.ArrayList@1470}  size = 4
 0 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@3663} "BLOCK: prefix=a [61]"
 1 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@3668} "BLOCK: prefix=ai [61 69]"
 2 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@3669} "BLOCK: prefix=aq [61 71]"
 3 = {org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter$PendingBlock@3670} "BLOCK: prefix=au [61 75]"
```

编译newBlocks中的前缀索引，转换成FST数据结构index，最后将index赋值到newBlocks的第一个PendingBlock的index字段。编译成FST时以newBlocks的第一个PendingBlock为起点。

FST的输出组成如下：

第一段以newBlocks的第一个PendingBlock的fp, hasTerms, isFloor三个字段用encodeOutput方法编码成一个Long类型数字，最后以VLong编码存储到scratchBytes。
fq=5266
hasTerms=true
isFloor=true

第二段以除去newBlocks的第一个PendingBlock后，newBlocks中还有的PendingBlock个数编码成VInt存储到scratchBytes。

接下来存储的是除去newBlocks的第一个PendingBlock后的每个PendingBlock的floorLeadByte和(sub.fp - fp) << 1 | (sub.hasTerms ? 1 : 0)以VLong编码存储。

sub.fp=5841
fq=5266
sub.hasTerms=true

FST的输入为prefix

使用FST的输入和输出构建FST

最后将newBlocks中每个PendingBlock的子索引合并到当前FST中

public void compileIndex(List<PendingBlock> blocks, RAMOutputStream scratchBytes, IntsRefBuilder scratchIntsRef) throws IOException；
