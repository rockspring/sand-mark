2个节点分布式solr服务

一个leader有数据，先启动

另一个节点没数据，后启动

跟踪follower节点的recovery过程

什么时候触发？



初始化RecoveryStrategy

```
coreZkRegister-1-thread-1@3300, prio=5, in group 'main', status: 'RUNNING'
	  at org.apache.solr.cloud.RecoveryStrategy.<init>(RecoveryStrategy.java:94)
	  at org.apache.solr.update.DefaultSolrCoreState.doRecovery(DefaultSolrCoreState.java:316)
	  at org.apache.solr.cloud.ZkController.checkRecovery(ZkController.java:993)
	  at org.apache.solr.cloud.ZkController.register(ZkController.java:824)
	  at org.apache.solr.cloud.ZkController.register(ZkController.java:738)
	  at org.apache.solr.core.ZkContainer$2.run(ZkContainer.java:263)
	  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	  at java.lang.Thread.run(Thread.java:745)
```




以下几种条件follower应该从leader做recovery操作

1 核心重载且重载核心时需要recovery



/solr/admin/cores?action=PREPRECOVERY&core=collection1&nodeName=192.168.59.3%3A8984_solr&coreNodeName=core_node2&state=recovering&checkLive=true&onlyIfLeader=true&onlyIfLeaderActive=true&wt=javabin&version=2








follower节点启动时启动了那些线程？

[RecoveryThread]
[coreLoadExecutor-4-thread-1]
[coreZkRegister-1-thread-1]
[httpShardExecutor-3-thread-1]
[main-EventThread]
[main-SendThread(localhost:2181)]
[main]
[searcherExecutor-5-thread-1]

grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep -v coreLoadExecutor-4-thread-1 | grep -v  coreZkRegister-1-thread-1 | grep -v  httpShardExecutor-3-thread-1 | grep -v searcherExecutor-5-thread-1 | grep -v RecoveryThread >solr.log.[main]


grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep coreLoadExecutor-4-thread-1 >solr.log.coreLoadExecutor-4-thread-1


grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep coreZkRegister-1-thread-1>solr.log.coreZkRegister-1-thread-1

grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep httpShardExecutor-3-thread-1>solr.log.httpShardExecutor-3-thread-1


grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep searcherExecutor-5-thread-1>solr.log.searcherExecutor-5-thread-1

grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep RecoveryThread>solr.log.RecoveryThread









8983 leader节点

grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep Thread-14>solr.log.Thread-14

grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep main-EventThread >solr.log.main-EventThread

grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep qtp1161035867-12 >solr.log.qtp1161035867-12

grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep qtp1161035867-14 >solr.log.qtp1161035867-14

grep -v loaded solr.log | grep -v ClassLoader | grep -v ResourceLoader | grep qtp1161035867-18 >solr.log.qtp1161035867-18