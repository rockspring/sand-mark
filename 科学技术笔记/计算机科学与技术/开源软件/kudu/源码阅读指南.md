# 源码阅读指南


gutil Google公司开发的一些工具代码库，源自https://chromium.googlesource.com/chromium/chromium/+/master/base

util kudu项目的工具代码库


## gutil

原子操作

kudu/gutil/arm_instruction_set_select.h

kudu/gutil/atomicops-internals-macosx.h
kudu/gutil/atomicops-internals-powerpc.h

kudu/gutil/atomicops-internals-x86.h 实现了X86架构下的各种原子操作，使用汇编语言实现
kudu/gutil/atomicops-internals-x86.cc 实现了获取CPU信息的方法，基于cpuid指令的汇编语言实现

kudu/gutil/atomicops-internals-tsan.h

kudu/gutil/atomicops.h 速度很快的原子操作，实现与平台（x86等）相关。


bind

bind.h依赖如下文件

#include "kudu/gutil/bind_internal.h"
#include "kudu/gutil/callback_internal.h"

bind_internal.h依赖如下文件
#include "kudu/gutil/bind_helpers.h"
#include "kudu/gutil/callback_internal.h"
#include "kudu/gutil/raw_scoped_refptr_mismatch_checker.h"
#include "kudu/gutil/template_util.h"

callback_internal.h依赖如下文件
#include <stddef.h>

#include "kudu/gutil/gscoped_ptr.h"
#include "kudu/gutil/ref_counted.h"

callback.h
模板化的Callback类是一个泛型的函数对象。模板化的Callback类与bind函数一起产生类型安全的偏函数。

Partial application（Currying）偏函数应用。通过固定一个函数的部分参数，产生一个参数更少的函数。
The design Callback and Bind is heavily influenced by C++'s tr1::function/tr1::bind, and by the "Google Callback" system used inside Google.



## kudu-master

入口

master_main.cc:60

启动tablet服务器

master_main.cc:70

启动RPC服务的监听端口

rpc_server.cc:164 Bound to: 0.0.0.0:7051

启动webserver

webserver.cc:133 0.0.0.0:8051

MasterMain是一个启动服务器的辅助类，调用InitKuduOrDie方法初始化，调用ParseCommandLineFlags解析命令行参数，调用InitGoogleLoggingSafe初始化日志系统，创建Master，调用Master的Init方法初始化，调用Master的Start方法启动。


Master聚合其他组件的聚合关系

TSManager
CatalogManager
MasterPathHandlers
MaintenanceManager

TSManager构造函数什么都不做

CatalogManager创建一个线程池，只有一个线程。

MasterPathHandlers构造函数什么都不做


MaintenanceOp是MaintenanceManager可以调度的后台操作。MaintenanceOpStats是MaintenanceOp的统计。

## kudu-tserver

入口

tablet_server_main.cc:64

启动tablet服务器

tablet_server_main.cc:76

启动RPC服务的监听端口

rpc_server.cc:164 Bound to: 0.0.0.0:7050

启动webserver

webserver.cc:133 0.0.0.0:8050

tablet服务器与kudu-tserver的RPC端口7851建立连接