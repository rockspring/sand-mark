网络组件

NetworkEnvironment

每个TaskManager实例有一个NetworkEnvironment组件。NetworkEnvironment包含了跟踪中间结果和交换数据的数据结构。当NetworkEnvironment初始化时，它会分配网络缓冲池。NetworkEnvironment包含的其它组件，比如netty、中间结果管理器等，仅在它关联到TaskManager和JobManager时创建。当TaskManager的Actor系统创建后，它会像JobManager注册自己，注册后TaskManager就和JobManger关联了。

## 网络组件

### NetworkEnvironment

每个TaskManager实例有一个NetworkEnvironment组件。NetworkEnvironment包含了跟踪中间结果和交换数据的数据结构。当NetworkEnvironment初始化时，它会分配网络缓冲池。NetworkEnvironment包含的其它组件，比如netty、中间结果管理器等，仅在它关联到TaskManager和JobManager时创建。当TaskManager的Actor系统创建后，它会向JobManager注册自己，注册后TaskManager就和JobManger关联了。

1 NetworkEnvironmentConfiguration

Scala实现的case类

2 FiniteDuration

有限持续时间

Scala类库的代码

3 NetworkBufferPool

固定大小的池子，池子里放的是MemorySegment实例，用于网络栈。

NetworkBufferPool创建出LocalBufferPool，每个任务从LocalBufferPool中划分一块缓冲区用于网络数据传输。当LocalBufferPool被创建后，NetworkBufferPool会动态地在池子之间重新分配缓冲区。

4 ConnectionManager

一个接口。管理逻辑远程输入通道的的物理连接。

5 ResultPartitionManager

跟踪task manager当前所有产生的和消费的分区。

6 TaskEventDispatcher

分发从消费任务到生产任务的反向事件。反向事件仅仅适用于产生管道结果的任务，生产任务和消费任务在同时运行。


7 ResultPartitionConsumableNotifier

一个接口。通知一个分区可以被消费。

8 PartitionStateChecker

一个接口。触发分区状态检查。

9 ExecutionContext

Sacala实现的特质（trait）。具有执行程序逻辑的实体抽象。


## 启动

```
"main@1" prio=5 tid=0x1 nid=NA runnable
  java.lang.Thread.State: RUNNABLE
	  at org.apache.flink.runtime.io.network.NetworkEnvironment.<init>(NetworkEnvironment.java:103)
	  at org.apache.flink.runtime.taskmanager.TaskManager$.startTaskManagerComponentsAndActor(TaskManager.scala:1813)
	  at org.apache.flink.runtime.taskmanager.TaskManager$.runTaskManager(TaskManager.scala:1713)
	  at org.apache.flink.runtime.taskmanager.TaskManager$.selectNetworkInterfaceAndRunTaskManager(TaskManager.scala:1579)
	  at org.apache.flink.runtime.taskmanager.TaskManager$.main(TaskManager.scala:1488)
	  at org.apache.flink.runtime.taskmanager.TaskManager.main(TaskManager.scala:-1)
```