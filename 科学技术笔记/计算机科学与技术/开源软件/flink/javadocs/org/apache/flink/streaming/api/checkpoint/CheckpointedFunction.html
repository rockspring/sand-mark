<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="zh">
<head>
<!-- Generated by javadoc (1.8.0_144) on Thu May 17 13:42:25 CST 2018 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>CheckpointedFunction</title>
<meta name="date" content="2018-05-17">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="CheckpointedFunction";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6,"i1":6};
var tabs = {65535:["t0","所有方法"],2:["t2","实例方法"],4:["t3","抽象方法"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>您的浏览器已禁用 JavaScript。</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="跳过导航链接">跳过导航链接</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../../../index-files/index-1.html">索引</a></li>
<li><a href="../../../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>上一个类</li>
<li><a href="../../../../../../org/apache/flink/streaming/api/checkpoint/ExternallyInducedSource.html" title="org.apache.flink.streaming.api.checkpoint中的接口"><span class="typeNameLink">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/flink/streaming/api/checkpoint/CheckpointedFunction.html" target="_top">框架</a></li>
<li><a href="CheckpointedFunction.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method.summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method.detail">方法</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.flink.streaming.api.checkpoint</div>
<h2 title="接口 CheckpointedFunction" class="title">接口 CheckpointedFunction</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>所有已知实现类:</dt>
<dd><a href="../../../../../../org/apache/flink/streaming/connectors/cassandra/AbstractCassandraTupleSink.html" title="org.apache.flink.streaming.connectors.cassandra中的类">AbstractCassandraTupleSink</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/fs/bucketing/BucketingSink.html" title="org.apache.flink.streaming.connectors.fs.bucketing中的类">BucketingSink</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/cassandra/CassandraPojoSink.html" title="org.apache.flink.streaming.connectors.cassandra中的类">CassandraPojoSink</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/cassandra/CassandraRowSink.html" title="org.apache.flink.streaming.connectors.cassandra中的类">CassandraRowSink</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/cassandra/CassandraScalaProductSink.html" title="org.apache.flink.streaming.connectors.cassandra中的类">CassandraScalaProductSink</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/cassandra/CassandraSinkBase.html" title="org.apache.flink.streaming.connectors.cassandra中的类">CassandraSinkBase</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/cassandra/CassandraTupleSink.html" title="org.apache.flink.streaming.connectors.cassandra中的类">CassandraTupleSink</a>, <a href="../../../../../../org/apache/flink/streaming/api/functions/source/ContinuousFileMonitoringFunction.html" title="org.apache.flink.streaming.api.functions.source中的类">ContinuousFileMonitoringFunction</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/elasticsearch/ElasticsearchSink.html" title="org.apache.flink.streaming.connectors.elasticsearch中的类">ElasticsearchSink</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/elasticsearch2/ElasticsearchSink.html" title="org.apache.flink.streaming.connectors.elasticsearch2中的类">ElasticsearchSink</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/elasticsearch5/ElasticsearchSink.html" title="org.apache.flink.streaming.connectors.elasticsearch5中的类">ElasticsearchSink</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/elasticsearch/ElasticsearchSinkBase.html" title="org.apache.flink.streaming.connectors.elasticsearch中的类">ElasticsearchSinkBase</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumer010.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaConsumer010</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumer011.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaConsumer011</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumer08.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaConsumer08</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumer081.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaConsumer081</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumer082.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaConsumer082</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumer09.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaConsumer09</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumerBase.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaConsumerBase</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaProducer</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer010.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaProducer010</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaProducer011</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer08.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaProducer08</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer09.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaProducer09</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducerBase.html" title="org.apache.flink.streaming.connectors.kafka中的类">FlinkKafkaProducerBase</a>, <a href="../../../../../../org/apache/flink/streaming/api/functions/source/FromElementsFunction.html" title="org.apache.flink.streaming.api.functions.source中的类">FromElementsFunction</a>, <a href="../../../../../../org/apache/flink/api/java/io/jdbc/JDBCSinkFunction.html" title="org.apache.flink.api.java.io.jdbc中的类">JDBCSinkFunction</a>, <a href="../../../../../../org/apache/flink/streaming/api/functions/source/MessageAcknowledgingSourceBase.html" title="org.apache.flink.streaming.api.functions.source中的类">MessageAcknowledgingSourceBase</a>, <a href="../../../../../../org/apache/flink/streaming/api/functions/source/MultipleIdsMessageAcknowledgingSourceBase.html" title="org.apache.flink.streaming.api.functions.source中的类">MultipleIdsMessageAcknowledgingSourceBase</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/rabbitmq/RMQSource.html" title="org.apache.flink.streaming.connectors.rabbitmq中的类">RMQSource</a>, <a href="../../../../../../org/apache/flink/streaming/connectors/fs/RollingSink.html" title="org.apache.flink.streaming.connectors.fs中的类">RollingSink</a>, <a href="../../../../../../org/apache/flink/streaming/api/functions/source/StatefulSequenceSource.html" title="org.apache.flink.streaming.api.functions.source中的类">StatefulSequenceSource</a>, <a href="../../../../../../org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.html" title="org.apache.flink.streaming.api.functions.sink中的类">TwoPhaseCommitSinkFunction</a></dd>
</dl>
<hr>
<br>
<pre><a href="../../../../../../org/apache/flink/annotation/PublicEvolving.html" title="org.apache.flink.annotation中的注释">@PublicEvolving</a>
public interface <span class="typeNameLabel">CheckpointedFunction</span></pre>
<div class="block">This is the core interface for <i>stateful transformation functions</i>, meaning functions
 that maintain state across individual stream records.
 While more lightweight interfaces exist as shortcuts for various types of state, this interface offer the
 greatest flexibility in managing both <i>keyed state</i> and <i>operator state</i>.

 <p>The section <a href="#shortcuts">Shortcuts</a> illustrates the common lightweight
 ways to setup stateful functions typically used instead of the full fledged
 abstraction represented by this interface.

 <h1>Initialization</h1>
 The <a href="../../../../../../org/apache/flink/streaming/api/checkpoint/CheckpointedFunction.html#initializeState-org.apache.flink.runtime.state.FunctionInitializationContext-"><code>initializeState(FunctionInitializationContext)</code></a> is called when
 the parallel instance of the transformation function is created during distributed execution.
 The method gives access to the <a href="../../../../../../org/apache/flink/runtime/state/FunctionInitializationContext.html" title="org.apache.flink.runtime.state中的接口"><code>FunctionInitializationContext</code></a> which in turn gives access
 to the to the <a href="../../../../../../org/apache/flink/api/common/state/OperatorStateStore.html" title="org.apache.flink.api.common.state中的接口"><code>OperatorStateStore</code></a> and <a href="../../../../../../org/apache/flink/api/common/state/KeyedStateStore.html" title="org.apache.flink.api.common.state中的接口"><code>KeyedStateStore</code></a>.

 <p>The <code>OperatorStateStore</code> and <code>KeyedStateStore</code> give access to the data structures
 in which state should be stored for Flink to transparently manage and checkpoint it, such as
 <a href="../../../../../../org/apache/flink/api/common/state/ValueState.html" title="org.apache.flink.api.common.state中的接口"><code>ValueState</code></a> or
 <a href="../../../../../../org/apache/flink/api/common/state/ListState.html" title="org.apache.flink.api.common.state中的接口"><code>ListState</code></a>.

 <p><b>Note:</b> The <code>KeyedStateStore</code> can only be used when the transformation supports
 <i>keyed state</i>, i.e., when it is applied on a keyed stream (after a <code>keyBy(...)</code>).

 <h1>Snapshot</h1>
 The <a href="../../../../../../org/apache/flink/streaming/api/checkpoint/CheckpointedFunction.html#snapshotState-org.apache.flink.runtime.state.FunctionSnapshotContext-"><code>snapshotState(FunctionSnapshotContext)</code></a> is called whenever a
 checkpoint takes a state snapshot of the transformation function. Inside this method, functions typically
 make sure that the checkpointed data structures (obtained in the initialization phase) are up
 to date for a snapshot to be taken. The given snapshot context gives access to the metadata
 of the checkpoint.

 <p>In addition, functions can use this method as a hook to flush/commit/synchronize with
 external systems.

 <h1>Example</h1>
 The code example below illustrates how to use this interface for a function that keeps counts
 of events per key and per parallel partition (parallel instance of the transformation function
 during distributed execution).
 The example also changes of parallelism, which affect the count-per-parallel-partition by
 adding up the counters of partitions that get merged on scale-down. Note that this is a
 toy example, but should illustrate the basic skeleton for a stateful function.

 <p><pre><code>
 public class MyFunction&lt;T&gt; implements MapFunction&lt;T, T&gt;, CheckpointedFunction {

     private ReducingState&lt;Long&gt; countPerKey;
     private ListState&lt;Long&gt; countPerPartition;

     private long localCount;

     public void initializeState(FunctionInitializationContext context) throws Exception {
         // get the state data structure for the per-key state
         countPerKey = context.getKeyedStateStore().getReducingState(
                 new ReducingStateDescriptor&lt;&gt;("perKeyCount", new AddFunction&lt;&gt;(), Long.class));

         // get the state data structure for the per-key state
         countPerPartition = context.getOperatorStateStore().getOperatorState(
                 new ListStateDescriptor&lt;&gt;("perPartitionCount", Long.class));

         // initialize the "local count variable" based on the operator state
         for (Long l : countPerPartition.get()) {
             localCount += l;
         }
     }

     public void snapshotState(FunctionSnapshotContext context) throws Exception {
         // the keyed state is always up to date anyways
         // just bring the per-partition state in shape
         countPerPartition.clear();
         countPerPartition.add(localCount);
     }

     public T map(T value) throws Exception {
         // update the states
         countPerKey.add(1L);
         localCount++;

         return value;
     }
 }
 </code></pre>

 <hr>

 <h1><a name="shortcuts">Shortcuts</a></h1>
 There are various ways that transformation functions can use state without implementing the
 full-fledged <code>CheckpointedFunction</code> interface:

 <h4>Operator State</h4>
 Checkpointing some state that is part of the function object itself is possible in a simpler way
 by directly implementing the <a href="../../../../../../org/apache/flink/streaming/api/checkpoint/ListCheckpointed.html" title="org.apache.flink.streaming.api.checkpoint中的接口"><code>ListCheckpointed</code></a> interface.
 That mechanism is similar to the previously used <code>Checkpointed</code> interface.

 <h4>Keyed State</h4>
 Access to keyed state is possible via the <a href="../../../../../../org/apache/flink/api/common/functions/RuntimeContext.html" title="org.apache.flink.api.common.functions中的接口"><code>RuntimeContext</code></a>'s methods:
 <pre><code>
 public class CountPerKeyFunction&lt;T&gt; extends RichMapFunction&lt;T, T&gt; {

     private ValueState&lt;Long&gt; count;

     public void open(Configuration cfg) throws Exception {
         count = getRuntimeContext().getState(new ValueStateDescriptor&lt;&gt;("myCount", Long.class));
     }

     public T map(T value) throws Exception {
         Long current = count.get();
         count.update(current == null ? 1L : current + 1);

         return value;
     }
 }
 </code></pre></div>
<dl>
<dt><span class="seeLabel">另请参阅:</span></dt>
<dd><a href="../../../../../../org/apache/flink/streaming/api/checkpoint/ListCheckpointed.html" title="org.apache.flink.streaming.api.checkpoint中的接口"><code>ListCheckpointed</code></a>, 
<a href="../../../../../../org/apache/flink/api/common/functions/RuntimeContext.html" title="org.apache.flink.api.common.functions中的接口"><code>RuntimeContext</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>方法概要</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="方法概要表, 列表方法和解释">
<caption><span id="t0" class="activeTableTab"><span>所有方法</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">实例方法</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">抽象方法</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">限定符和类型</th>
<th class="colLast" scope="col">方法和说明</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/flink/streaming/api/checkpoint/CheckpointedFunction.html#initializeState-org.apache.flink.runtime.state.FunctionInitializationContext-">initializeState</a></span>(<a href="../../../../../../org/apache/flink/runtime/state/FunctionInitializationContext.html" title="org.apache.flink.runtime.state中的接口">FunctionInitializationContext</a>&nbsp;context)</code>
<div class="block">This method is called when the parallel function instance is created during distributed
 execution.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/flink/streaming/api/checkpoint/CheckpointedFunction.html#snapshotState-org.apache.flink.runtime.state.FunctionSnapshotContext-">snapshotState</a></span>(<a href="../../../../../../org/apache/flink/runtime/state/FunctionSnapshotContext.html" title="org.apache.flink.runtime.state中的接口">FunctionSnapshotContext</a>&nbsp;context)</code>
<div class="block">This method is called when a snapshot for a checkpoint is requested.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>方法详细资料</h3>
<a name="snapshotState-org.apache.flink.runtime.state.FunctionSnapshotContext-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>snapshotState</h4>
<pre>void&nbsp;snapshotState(<a href="../../../../../../org/apache/flink/runtime/state/FunctionSnapshotContext.html" title="org.apache.flink.runtime.state中的接口">FunctionSnapshotContext</a>&nbsp;context)
            throws java.lang.Exception</pre>
<div class="block">This method is called when a snapshot for a checkpoint is requested. This acts as a hook to the function to
 ensure that all state is exposed by means previously offered through <a href="../../../../../../org/apache/flink/runtime/state/FunctionInitializationContext.html" title="org.apache.flink.runtime.state中的接口"><code>FunctionInitializationContext</code></a> when
 the Function was initialized, or offered now by <a href="../../../../../../org/apache/flink/runtime/state/FunctionSnapshotContext.html" title="org.apache.flink.runtime.state中的接口"><code>FunctionSnapshotContext</code></a> itself.</div>
<dl>
<dt><span class="paramLabel">参数:</span></dt>
<dd><code>context</code> - the context for drawing a snapshot of the operator</dd>
<dt><span class="throwsLabel">抛出:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
<a name="initializeState-org.apache.flink.runtime.state.FunctionInitializationContext-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>initializeState</h4>
<pre>void&nbsp;initializeState(<a href="../../../../../../org/apache/flink/runtime/state/FunctionInitializationContext.html" title="org.apache.flink.runtime.state中的接口">FunctionInitializationContext</a>&nbsp;context)
              throws java.lang.Exception</pre>
<div class="block">This method is called when the parallel function instance is created during distributed
 execution. Functions typically set up their state storing data structures in this method.</div>
<dl>
<dt><span class="paramLabel">参数:</span></dt>
<dd><code>context</code> - the context for initializing the operator</dd>
<dt><span class="throwsLabel">抛出:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="跳过导航链接">跳过导航链接</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../../../index-files/index-1.html">索引</a></li>
<li><a href="../../../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>上一个类</li>
<li><a href="../../../../../../org/apache/flink/streaming/api/checkpoint/ExternallyInducedSource.html" title="org.apache.flink.streaming.api.checkpoint中的接口"><span class="typeNameLink">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/flink/streaming/api/checkpoint/CheckpointedFunction.html" target="_top">框架</a></li>
<li><a href="CheckpointedFunction.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method.summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method.detail">方法</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
