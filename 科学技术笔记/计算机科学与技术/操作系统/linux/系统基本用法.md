# 系统基本用法

## 服务器登录

```
#!/bin/sh

eval `ssh-agent -s`
ssh-add

if [ "$1" = "" ]; then
	ssh -A leqinzhou@login-test.com
else
	ssh -A leqinzhou@login-test.com -t "ssh work@$1"
fi
```

/etc/apt/apt.conf.d/10periodic

```
APT::Periodic::Update-Package-Lists "1";
APT::Periodic::Download-Upgradeable-Packages "0";
APT::Periodic::AutocleanInterval "0";
```

htop - interactive process viewer

id 打印真实及有效用户和组ID
dpkg -L xxx 产看xxx包得安装信息，安装路径

perror 根据MySQL代码中错误id号打印出错误信息

http://bamboozhou.github.io/doc/mysql-master-slave.html


下载apt-get 服务器的公钥

wget 'http://10.10.3.224/anjuke-ubuntu/public.key' -O - | apt-key add -


-O 输出到文件 - 代表标准输出

apt-key - APT key management utility



initctl - init daemon control tool

restart 重启后台job

Linux 常用操作（Ubuntu）

## 时区

查看时区
date -R

修改时区
dpkg-reconfigure tzdata

## ssh操作
### ssh-keygen生成公钥和私钥

### 将公钥放入远程机的~/.ssh/authorized_keys文件中

```
方法一：
使用密码登陆远程机，编辑authorized_keys文件，将本地机的公钥加入文件末尾
方法二：
执行远程shell
ssh user@host 'mkdir -p .ssh && cat >> .ssh/authorized_keys' < ~/.ssh/id_rsa.pub
```

### 登陆远程机

ssh user@host

## rsync操作

rsync src user@host:dest

```
选项
--delete-after 同步完后删除本地端不存的文件
--delete-before 同步完后删除本地端不存的文件

-a 保留文件修改时间等很多东西，常用
-v 输出详细进度
```

创建账户
useradd zzz -g www-data -m -d /home/zzz -s /bin/bash

修改全局环境配置
vim /etc/profile

## 配置时区

dpkg-reconfigure tzdata

## 系统启动

```
start-stop-daemon

service

/etc/init.d/


/lib/lsb/init-functions

https://refspecs.linuxbase.org/LSB_2.1.0/LSB-generic/LSB-generic/iniscrptfunc.html


set -e 打开shell的选项errexit

umask


PrivSep = Privilege separation 



deb包

dh-make

tool that converts source archives into Debian package source
 This package allows you to take a standard (or upstream) source package
 and convert it into a format that will allow you to build Debian packages.
 .
 After answering a few questions, dh_make will then provide a set of
 templates that, after some small editing, will allow you to create a
 Debian package.


dpkg-buildpackage - build binary or source packages from sources

dpkg-buildpackage -rfakeroot

dpkg -b

-b, --build directory [archive|directory]
    Build a deb package.

```

## 编写自启动脚本

```
# ssh - OpenBSD Secure Shell server
#
# The OpenSSH server provides secure shell access to the system.

description	"OpenSSH server"

start on runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit 10 5
umask 022

env SSH_SIGSTOP=1
expect stop

# 'sshd -D' leaks stderr and confuses things in conjunction with 'console log'
console none

pre-start script
    test -x /usr/sbin/sshd || { stop; exit 0; }
    test -e /etc/ssh/sshd_not_to_be_run && { stop; exit 0; }

    mkdir -p -m0755 /var/run/sshd
end script

# if you used to set SSHD_OPTS in /etc/default/ssh, you can change the
# 'exec' line here instead
exec /usr/sbin/sshd -D
```

## 安装内核调试符号

### GPG key import

sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys C8CAB6595FDFF622 

### Add repository config

codename=$(lsb_release -c | awk  '{print $2}')
sudo tee /etc/apt/sources.list.d/ddebs.list << EOF
deb http://ddebs.ubuntu.com/ ${codename}      main restricted universe multiverse
deb http://ddebs.ubuntu.com/ ${codename}-security main restricted universe multiverse
deb http://ddebs.ubuntu.com/ ${codename}-updates  main restricted universe multiverse
deb http://ddebs.ubuntu.com/ ${codename}-proposed main restricted universe multiverse
EOF

sudo apt-get update
sudo apt-get install linux-image-$(uname -r)-dbgsym

### 参考链接

https://wiki.ubuntu.com/Kernel/Systemtap#Where_to_get_debug_symbols_for_kernel_X.3F

http://blog.jeffli.me/blog/2014/10/10/install-systemtap-in-ubuntu-14-dot-04/