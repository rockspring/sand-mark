相关书籍

https://www.zhihu.com/question/21390646

https://www.cl.cam.ac.uk/~rja14/book.html

http://www.kerberos.org/software/adminkerberos.pdf

https://docs.oracle.com/cd/E19455-01/806-3814/806-3814.pdf

http://web.mit.edu/kerberos/krb5-1.10/krb5-1.10/doc/admin-guide.pdf

https://www.secure-endpoints.com/talks/Kerberos_Tutorial_BPW2007.pdf

http://www.cloudera.com/documentation/enterprise/latest/PDF/cloudera-security.pdf



GSS

Generic Security Service Application Program Interface, Version 2

Simple Authentication and Security Layer (SASL)



https://issues.apache.org/jira/browse/ZOOKEEPER-1045

https://github.com/ekoontz/zookeeper/wiki

https://cwiki.apache.org/confluence/display/ZOOKEEPER/Zookeeper+and+SASL

https://www.slac.stanford.edu/comp/unix/sshGSSAPI.html

https://support.apple.com/en-us/HT202545

https://docs.oracle.com/javase/8/docs/technotes/guides/security/jgss/tutorials/index.html

http://lyb520320.iteye.com/blog/720478



When users attempt to use Kerberos and specify a principal or user name without specifying what administrative Kerberos realm that principal belongs to, the system appends  │
 │ the default realm.  The default realm may also be used as the realm of a Kerberos service running on the local machine.  Often, the default realm is the uppercase version   │
 │ of the local DNS domain.                                                                                                                                                     │
 │                                                                                                                                                                              │
 │ Default Kerberos version 5 realm:                                                                                                                                            │
 │                                                                                                                                                                              │
 │ 04-AMD64-VBOX________________


 Enter the hostnames of Kerberos servers in the 04-AMD64-VBOX Kerberos realm separated by spaces.  │
                                       │                                                                                                   │
                                       │ Kerberos servers for your realm:



                                       kdc.loclhost



Enter the hostname of the administrative (password changing) server for the 04-AMD64-VBOX Kerberos realm.  │
                                  │                                                                                                            │
                                  │ Administrative server for your Kerberos realm: kdc.loclhost


Setting up a Kerberos Realm                                                                                                                       │
               │                                                                                                                                                   │
               │ This package contains the administrative tools required to run the Kerberos master server.                                                        │
               │                                                                                                                                                   │
               │ However, installing this package does not automatically set up a Kerberos realm.  This can be done later by running the "krb5_newrealm" command.  │
               │                                                                                                                                                   │
               │ Please also read the /usr/share/doc/krb5-kdc/README.KDC file and the administration guide found in the krb5-doc package.



sudo apt-get update
sudo apt-get install krb5-kdc krb5-admin-server

sudo kdb5_util create -s

屏幕输出

```
root@swimmingsand-usa:~# kdb5_util create -s
Loading random data
Initializing database '/var/lib/krb5kdc/principal' for realm 'LOCALHOST',
master key name 'K/M@LOCALHOST'
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.
Enter KDC database master key:
```

admin


root@swimmingsand-usa:~# kadmin.local
Authenticating as principal root/admin@LOCALHOST with password.
kadmin.local:


输入addprinc -randkey zookeeper/localhost

root@swimmingsand-usa:~# kadmin.local
Authenticating as principal root/admin@LOCALHOST with password.
kadmin.local:  addprinc -randkey zookeeper/localhost
WARNING: no policy specified for zookeeper/localhost@LOCALHOST; defaulting to no policy
Principal "zookeeper/localhost@LOCALHOST" created.
kadmin.local:

输入ktadd -k /root/zookeeper/conf/zookeeper.keytab zookeeper/localhost

或输入ktadd -k /vagrant/projects/server/zookeeper/zookeeper.keytab zookeeper/localhost

root@swimmingsand-usa:~# kadmin.local
Authenticating as principal root/admin@LOCALHOST with password.
kadmin.local:  addprinc -randkey zookeeper/localhost
WARNING: no policy specified for zookeeper/localhost@LOCALHOST; defaulting to no policy
Principal "zookeeper/localhost@LOCALHOST" created.
kadmin.local:  ktadd -k /root/zookeeper/conf/zookeeper.keytab zookeeper/localhost
Entry for principal zookeeper/localhost with kvno 3, encryption type aes256-cts-hmac-sha1-96 added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
Entry for principal zookeeper/localhost with kvno 3, encryption type arcfour-hmac added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
Entry for principal zookeeper/localhost with kvno 3, encryption type des3-cbc-sha1 added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
Entry for principal zookeeper/localhost with kvno 3, encryption type des-cbc-crc added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
kadmin.local:


输入addprinc -randkey myzkclient

```
root@swimmingsand-usa:~# kadmin.local
Authenticating as principal root/admin@LOCALHOST with password.
kadmin.local:  addprinc -randkey zookeeper/localhost
WARNING: no policy specified for zookeeper/localhost@LOCALHOST; defaulting to no policy
Principal "zookeeper/localhost@LOCALHOST" created.
kadmin.local:  ktadd -k /home/ec2-user/zookeeper/conf/zookeeper.keytab zookeeper/localhost
kadmin.local: Key table file '/home/ec2-user/zookeeper/conf/zookeeper.keytab' not found while adding key to keytab
kadmin.local:  ktadd -k /root/zookeeper/conf/zookeeper.keytab zookeeper/localhost
Entry for principal zookeeper/localhost with kvno 3, encryption type aes256-cts-hmac-sha1-96 added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
Entry for principal zookeeper/localhost with kvno 3, encryption type arcfour-hmac added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
Entry for principal zookeeper/localhost with kvno 3, encryption type des3-cbc-sha1 added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
Entry for principal zookeeper/localhost with kvno 3, encryption type des-cbc-crc added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
kadmin.local:  addprinc -randkey myzkclient
WARNING: no policy specified for myzkclient@LOCALHOST; defaulting to no policy
Principal "myzkclient@LOCALHOST" created.
kadmin.local:
```

输入ktadd -k /root/zookeeper/conf/myzkclient.keytab myzkclient
或输入ktadd -k /vagrant/projects/server/zookeeper/myzkclient.keytab myzkclient


```
root@swimmingsand-usa:~# kadmin.local
Authenticating as principal root/admin@LOCALHOST with password.
kadmin.local:  addprinc -randkey zookeeper/localhost
WARNING: no policy specified for zookeeper/localhost@LOCALHOST; defaulting to no policy
Principal "zookeeper/localhost@LOCALHOST" created.
kadmin.local:  ktadd -k /home/ec2-user/zookeeper/conf/zookeeper.keytab zookeeper/localhost
kadmin.local: Key table file '/home/ec2-user/zookeeper/conf/zookeeper.keytab' not found while adding key to keytab
kadmin.local:  ktadd -k /root/zookeeper/conf/zookeeper.keytab zookeeper/localhost
Entry for principal zookeeper/localhost with kvno 3, encryption type aes256-cts-hmac-sha1-96 added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
Entry for principal zookeeper/localhost with kvno 3, encryption type arcfour-hmac added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
Entry for principal zookeeper/localhost with kvno 3, encryption type des3-cbc-sha1 added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
Entry for principal zookeeper/localhost with kvno 3, encryption type des-cbc-crc added to keytab WRFILE:/root/zookeeper/conf/zookeeper.keytab.
kadmin.local:  addprinc -randkey myzkclient
WARNING: no policy specified for myzkclient@LOCALHOST; defaulting to no policy
Principal "myzkclient@LOCALHOST" created.
kadmin.local:  ktadd -k /root/zookeeper/conf/myzkclient.keytab myzkclient
Entry for principal myzkclient with kvno 2, encryption type aes256-cts-hmac-sha1-96 added to keytab WRFILE:/root/zookeeper/conf/myzkclient.keytab.
Entry for principal myzkclient with kvno 2, encryption type arcfour-hmac added to keytab WRFILE:/root/zookeeper/conf/myzkclient.keytab.
Entry for principal myzkclient with kvno 2, encryption type des3-cbc-sha1 added to keytab WRFILE:/root/zookeeper/conf/myzkclient.keytab.
Entry for principal myzkclient with kvno 2, encryption type des-cbc-crc added to keytab WRFILE:/root/zookeeper/conf/myzkclient.keytab.
kadmin.local:
```


```
root@swimmingsand-usa:~# cat /etc/krb5.conf
[libdefaults]
  default_realm = LOCALHOST

# The following krb5.conf variables are only for MIT Kerberos.
  krb4_config = /etc/krb.conf
  krb4_realms = /etc/krb.realms
  kdc_timesync = 1
  ccache_type = 4
  forwardable = true
  proxiable = true

# The following encryption type specification will be used by MIT Kerberos
# if uncommented.  In general, the defaults in the MIT Kerberos code are
# correct and overriding these specifications only serves to disable new
# encryption types as they are added, creating interoperability problems.
#
# Thie only time when you might need to uncomment these lines and change
# the enctypes is if you have local software that will break on ticket
# caches containing ticket encryption types it doesn't know about (such as
# old versions of Sun Java).

# default_tgs_enctypes = des3-hmac-sha1
# default_tkt_enctypes = des3-hmac-sha1
# permitted_enctypes = des3-hmac-sha1

# The following libdefaults parameters are only for Heimdal Kerberos.
  v4_instance_resolve = false
  v4_name_convert = {
    host = {
      rcmd = host
      ftp = ftp
    }
    plain = {
      something = something-else
    }
  }
  fcc-mit-ticketflags = true

[realms]
  LOCALHOST = {
    kdc = localhost
    admin_server = localhost
  }
  ATHENA.MIT.EDU = {
    kdc = kerberos.mit.edu:88
    kdc = kerberos-1.mit.edu:88
    kdc = kerberos-2.mit.edu:88
    admin_server = kerberos.mit.edu
    default_domain = mit.edu
  }
  MEDIA-LAB.MIT.EDU = {
    kdc = kerberos.media.mit.edu
    admin_server = kerberos.media.mit.edu
  }
  ZONE.MIT.EDU = {
    kdc = casio.mit.edu
    kdc = seiko.mit.edu
    admin_server = casio.mit.edu
  }
  MOOF.MIT.EDU = {
    kdc = three-headed-dogcow.mit.edu:88
    kdc = three-headed-dogcow-1.mit.edu:88
    admin_server = three-headed-dogcow.mit.edu
  }
  CSAIL.MIT.EDU = {
    kdc = kerberos-1.csail.mit.edu
    kdc = kerberos-2.csail.mit.edu
    admin_server = kerberos.csail.mit.edu
    default_domain = csail.mit.edu
    krb524_server = krb524.csail.mit.edu
  }
  IHTFP.ORG = {
    kdc = kerberos.ihtfp.org
    admin_server = kerberos.ihtfp.org
  }
  GNU.ORG = {
    kdc = kerberos.gnu.org
    kdc = kerberos-2.gnu.org
    kdc = kerberos-3.gnu.org
    admin_server = kerberos.gnu.org
  }
  1TS.ORG = {
    kdc = kerberos.1ts.org
    admin_server = kerberos.1ts.org
  }
  GRATUITOUS.ORG = {
    kdc = kerberos.gratuitous.org
    admin_server = kerberos.gratuitous.org
  }
  DOOMCOM.ORG = {
    kdc = kerberos.doomcom.org
    admin_server = kerberos.doomcom.org
  }
  ANDREW.CMU.EDU = {
    kdc = kerberos.andrew.cmu.edu
    kdc = kerberos2.andrew.cmu.edu
    kdc = kerberos3.andrew.cmu.edu
    admin_server = kerberos.andrew.cmu.edu
    default_domain = andrew.cmu.edu
  }
  CS.CMU.EDU = {
    kdc = kerberos.cs.cmu.edu
    kdc = kerberos-2.srv.cs.cmu.edu
    admin_server = kerberos.cs.cmu.edu
  }
  DEMENTIA.ORG = {
    kdc = kerberos.dementix.org
    kdc = kerberos2.dementix.org
    admin_server = kerberos.dementix.org
  }
  stanford.edu = {
    kdc = krb5auth1.stanford.edu
    kdc = krb5auth2.stanford.edu
    kdc = krb5auth3.stanford.edu
    master_kdc = krb5auth1.stanford.edu
    admin_server = krb5-admin.stanford.edu
    default_domain = stanford.edu
  }
        UTORONTO.CA = {
                kdc = kerberos1.utoronto.ca
                kdc = kerberos2.utoronto.ca
                kdc = kerberos3.utoronto.ca
                admin_server = kerberos1.utoronto.ca
                default_domain = utoronto.ca
  }

[domain_realm]
  .mit.edu = ATHENA.MIT.EDU
  mit.edu = ATHENA.MIT.EDU
  .media.mit.edu = MEDIA-LAB.MIT.EDU
  media.mit.edu = MEDIA-LAB.MIT.EDU
  .csail.mit.edu = CSAIL.MIT.EDU
  csail.mit.edu = CSAIL.MIT.EDU
  .whoi.edu = ATHENA.MIT.EDU
  whoi.edu = ATHENA.MIT.EDU
  .stanford.edu = stanford.edu
  .slac.stanford.edu = SLAC.STANFORD.EDU
        .toronto.edu = UTORONTO.CA
        .utoronto.ca = UTORONTO.CA

[login]
  krb4_convert = true
  krb4_get_tickets = false
```


```
root@swimmingsand-usa:~/zookeeper# pwd
/root/zookeeper
root@swimmingsand-usa:~/zookeeper# kinit -k -t zookeeper.keytab zookeeper/localhost
root@swimmingsand-usa:~/zookeeper# klist
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: zookeeper/localhost@LOCALHOST

Valid starting       Expires              Service principal
04/14/2016 22:53:24  04/15/2016 08:53:24  krbtgt/LOCALHOST@LOCALHOST
  renew until 04/15/2016 22:53:24
```

```
root@swimmingsand-usa:~/zookeeper# kinit -k -t myzkclient.keytab  myzkclient
root@swimmingsand-usa:~/zookeeper# klist
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: myzkclient@LOCALHOST

Valid starting       Expires              Service principal
04/14/2016 22:54:28  04/15/2016 08:54:28  krbtgt/LOCALHOST@LOCALHOST
  renew until 04/15/2016 22:54:28
```